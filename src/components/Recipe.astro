---
import Chip from "./Chip.astro"
import { Picture } from "astro:assets"
import { Icon } from "astro-icon/components"
import "./recipe.scss"

interface Props {
  image?: any
  source?: string
  tags?: string[]
  title: string
  tagFilters: string[]
  notes?: string
  type?: string
  slug?: string
}

const {
  image,
  source,
  tags = [],
  title,
  tagFilters = [],
  notes,
  type,
  slug,
} = Astro.props

const capitalizeTitle = (title = "") =>
  title
    .split(" ")
    .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
    .join(" ")

const tagFiltersSet = new Set(tagFilters)
---

<div class="recipe fade-in">
  <h2 class="recipe__title">
    {capitalizeTitle(title)}
    {
      notes && notes.trim() !== "" && (
        <span
          class="recipe__note-icon"
          data-tooltip={notes}
          role="button"
          tabindex="0"
          aria-label="Recipe notes"
        >
          <Icon name="fa6-regular:note-sticky" />
        </span>
      )
    }
  </h2>
  <div class="recipe__body">
    {
      image &&
        (type === "custom-recipe" ? (
          <a href={slug} class="recipe__link">
            <Picture
              src={image}
              alt={title}
              class="recipe__image"
              widths={[300, 450, 600, 800]}
              sizes="(max-width: 768px) 100vw, (max-width: 1088px) 50vw, 33vw"
              formats={["avif", "webp"]}
              quality={70}
              loading="lazy"
            />
          </a>
        ) : (
          <a
            href={source}
            target="_blank"
            rel="nofollow noopener noreferrer"
            class="recipe__link"
          >
            <Picture
              src={image}
              alt={title}
              class="recipe__image"
              widths={[300, 450, 600, 800]}
              sizes="(max-width: 768px) 100vw, (max-width: 1088px) 50vw, 33vw"
              formats={["avif", "webp"]}
              quality={70}
              loading="lazy"
            />
          </a>
        ))
    }
    <div class="recipe__body__chips">
      {
        tags &&
          tags
            .sort()
            .map((tag) => (
              <Chip
                label={tag}
                data-tag={tag}
                active={tagFiltersSet.has(tag)}
              />
            ))
      }
    </div>
  </div>
</div>
