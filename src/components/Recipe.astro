---
import Chip from "./Chip.astro";
import { Image } from "astro:assets";
import "./recipe.scss";

interface Props {
  image?: any;
  source?: string;
  tags?: string[];
  title: string;
  tagFilters: string[];
  notes?: string;
  type?: string;
  slug?: string;
}

const { image, source, tags = [], title, tagFilters = [], notes, type, slug } = Astro.props;

const capitalizeTitle = (title = "") =>
  title
    .split(" ")
    .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
    .join(" ");

const tagFiltersSet = new Set(tagFilters);
---

<div class="recipe fade-in">
  <h2 class="recipe__title">
    {capitalizeTitle(title)}
    {notes && notes.trim() !== "" && (
      <span
        class="recipe__note-icon"
        data-tooltip={notes}
        role="button"
        tabindex="0"
      >
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
          <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm0 4c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm6 12H6v-1.4c0-2 4-3.1 6-3.1s6 1.1 6 3.1V19z"/>
        </svg>
      </span>
    )}
  </h2>
  <div class="recipe__body">
    {image &&
      (type === "custom-recipe" ? (
        <a href={slug} class="recipe__link">
          <Image
            src={image}
            alt={title}
            class="recipe__image"
            width={600}
            height={400}
            format="webp"
            loading="lazy"
          />
        </a>
      ) : (
        <a
          href={source}
          target="_blank"
          rel="nofollow noopener noreferrer"
          class="recipe__link"
        >
          <Image
            src={image}
            alt={title}
            class="recipe__image"
            width={600}
            height={400}
            format="webp"
            loading="lazy"
          />
        </a>
      ))}
    <div class="recipe__body__chips">
      {tags &&
        tags.sort().map((tag) => (
          <Chip
            label={tag}
            data-tag={tag}
            active={tagFiltersSet.has(tag)}
          />
        ))}
    </div>
  </div>
</div>

<style>
  .recipe__note-icon {
    position: relative;
    cursor: pointer;
    margin-left: 8px;
    display: inline-flex;
    align-items: center;
  }

  .recipe__note-icon::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: 125%;
    left: 50%;
    transform: translateX(-50%);
    background-color: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 8px 12px;
    border-radius: 4px;
    white-space: normal;
    max-width: 200px;
    font-size: 0.875rem;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
    z-index: 1000;
  }

  .recipe__note-icon:hover::after,
  .recipe__note-icon:focus::after {
    opacity: 1;
  }
</style>
